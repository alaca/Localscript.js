/* localscript.js [c]2017 Ante Laca */
(function(a){'use strict';const b=a.document,c=a.localStorage||!1,f=b.currentScript||b.querySelector('script[data-expire]'),g='false'!==f.getAttribute('data-cache'),h=j=>{let k=[];return j.forEach(l=>{let m=new Promise((n,o)=>{if(!l.url)return n(l.code);let p=c&&g?c.getItem(l.url):null;if(null===p){let q=new XMLHttpRequest;q.open('get',l.url),q.onload=function(){if(200==q.status){if(c&&g)try{c.setItem(l.url,q.response)}catch(r){c.clear()}return n(q.response)}return o(new Error(q.responseURL+' '+q.statusText))},setTimeout(()=>{if(4>q.readyState)return q.abort(),o(new Error(l.url+' timeout'))},1e4),q.send()}else return n(p)});k.push(m)}),Promise.all(k)};b.addEventListener('DOMContentLoaded',function(){let j=[],k=b.getElementsByTagName('script');if(c){const l=Math.floor(new Date().getTime()/1e3),m=c.getItem('ls-expire'),n=f.getAttribute('data-expire')||3600;(null===m||l>m)&&(c.clear(),c.setItem('ls-expire',parseInt(l)+parseInt(n)))}for(let l in k)'text/localscript'==k[l].type&&j.push({url:k[l].getAttribute('data-src')||!1,code:k[l].innerHTML||null});h(j).then(l=>{for(let m in l)try{(0,eval)(l[m])}catch(n){console.log(n.name,n.message)}}).catch(l=>{console.log(l)})},!1)})(this);